<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Women's Shoes - Shop Page</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link href="./output.css" rel="stylesheet" />
    <script>
      async function loadContent() {
        // Load header
        const headerResponse = await fetch("header.html");
        const headerData = await headerResponse.text();
        document.getElementById("header").innerHTML = headerData;

        // Load footer
        const footerResponse = await fetch("footer.html");
        const footerData = await footerResponse.text();
        document.getElementById("footer").innerHTML = footerData;

        // Show the main content after loading header and footer
        document.getElementById("main-content").style.display = "block";
      }

      // Load content when the DOM is fully loaded
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("main-content").style.display = "none"; // Hide main content initially
        loadContent();
      });
    </script>
  </head>
  <body class="bg-gray-100">
    <!-- Header Include -->
    <div id="header"></div>

    <div id="main-content" style="display: none">
      <!-- Category Navigation -->
      <section class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
        <h1 class="mb-4 text-3xl font-bold" id="segment-title">
          Women's Shoes
        </h1>
        <nav class="mb-6">
          <ul id="category-list" class="flex space-x-6 text-lg font-medium">
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'all', this, true, false)"
            >
              All
            </li>
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'sneakers', this, true, false)"
            >
              Sneakers
            </li>
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'running', this, true, false)"
            >
              Running
            </li>
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'slides', this, true, false)"
            >
              Slides
            </li>
            <!-- <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'training', this, true, false)"
            >
              Training and Gym
            </li>
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'skateboarding', this, true, false)"
            >
              Skateboarding
            </li>
            <li
              class="cursor-pointer border-b-2 border-transparent hover:text-blue-500"
              onclick="showProducts(selectedSegment, 'basketball', this, true, false)"
            >
              Basketball
            </li> -->
          </ul>
        </nav>

        <!-- Product Grid -->
        <div
          id="product-grid"
          class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"
        ></div>
        <!-- Load More Button -->
        <div class="mt-8 text-center">
          <button
            id="load-more-button"
            class="rounded-full bg-black px-6 py-3 text-lg font-medium text-white hover:bg-gray-500"
          >
            Load More
          </button>
          <div id="message-container" class="mt-4"></div>
        </div>
      </section>
    </div>
    <script>
      let offset = 0; // Start from the beginning
      const limit = 4; // Number of items to load per click
      let previousSegment; // Declare a variable in the outer scope
      let previousCategory; // Declare a variable in the outer scope

      document
        .getElementById("load-more-button")
        .addEventListener("click", () => {
          showProducts(selectedSegment, previousCategory, this, false);
        });

      document
        .getElementById("category-list")
        .addEventListener("click", function () {
          // Clear the message
          document.getElementById("message-container").innerHTML = "";
        });

      function getSegmentFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get("segment") || "women";
      }

      async function showProducts(
        segment,
        category,
        selectedCategory,
        fade = true,
        offsetFlag = true,
      ) {
        if (segment != previousSegment || category != previousCategory) {
          offset = 0;
        } else {
          // Update the offset for the next load
          offset += limit;
        }
        previousSegment = segment;
        previousCategory = category;

        if (!offsetFlag) {
          offset = 0;
        }

        const response = await fetch(
          `shop.php?segment=${segment}&category=${category}&offset=${offset}&limit=${limit}`,
        );

        const data = await response.text();

        // Append the new products to the grid
        if (offsetFlag) {
          document
            .getElementById("product-grid")
            .insertAdjacentHTML("beforeend", data);
        }

        const productGrid = document.getElementById("product-grid");
        const loadMoreButton = document.getElementById("load-more-button");
        const segmentTitle = document.getElementById("segment-title");

        // Format the segment title
        const formattedSegment =
          segment.charAt(0).toUpperCase() + segment.slice(1);
        // Set segment title
        if (formattedSegment == "Sale") {
          segmentTitle.innerText = `${formattedSegment}`;
          // Update the document title
          document.title = `${formattedSegment} Page`;
        } else {
          segmentTitle.innerText = `${formattedSegment}'s Shoes`;
          // Update the document title
          document.title = `${formattedSegment}'s Shoes - Shop Page`;
        }

        if (data === "") {
          fade = false;
        }

        loadMoreButton.style.display = "inline-block";

        if (fade) {
          productGrid.classList.add(
            "opacity-0",
            "transition-opacity",
            "duration-300",
          ); // Start fade out
          loadMoreButton.classList.add(
            "opacity-0",
            "transition-opacity",
            "duration-300",
          ); // Start fade out
        }
        if (data.trim() === "") {
          // If no more products, show the message and hide the button
          document.getElementById("message-container").innerHTML =
            "<p>No more products available.</p>";
          document.getElementById("load-more-button").style.display = "none";
        }
        // Update border color for selected category
        const categoryItems = document.querySelectorAll("#category-list li");
        if (!offsetFlag) {
          categoryItems.forEach((item) => {
            item.classList.remove("border-black");
            item.classList.add("border-transparent");
          });
        }
        selectedCategory.classList.remove("border-transparent");
        selectedCategory.classList.add("border-black");

        setTimeout(
          () => {
            productGrid.innerHTML = ""; // Clear existing products
            productGrid.innerHTML = data;

            // Fade in the new products if fade is true
            if (fade) {
              productGrid.classList.remove("opacity-0"); // Remove fade out class
              loadMoreButton.classList.remove("opacity-0"); // Remove fade out class
              productGrid.classList.add("opacity-100"); // Add fade in class
              loadMoreButton.classList.add("opacity-100"); // Add fade in class

              // Cleanup after fade in
              setTimeout(() => {
                productGrid.classList.remove("opacity-100");
                loadMoreButton.classList.remove("opacity-100");
              }, 300); // Duration of fade-in effect
            }
          },
          fade ? 300 : 0,
        ); // Duration of fade-out effect or 0 if not fading
      }

      // On page load, get the category from the URL and display products
      const selectedSegment = getSegmentFromURL();
      // Show sneakers by default without fading
      showProducts(
        selectedSegment,
        "all",
        document.querySelector("#category-list li:first-child"),
        false,
        true,
      );
    </script>
    <!-- Footer Include -->
    <div id="footer"></div>
  </body>
</html>
